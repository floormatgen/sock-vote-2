openapi: 3.1.0
info:
  title: sock-vote
  description: 
    Server API for sock-vote.
    This document lays out the APIs for the server component of SockVote.
  version: 0.1.0

servers:
  - url: localhost:8080
    description:
      Local development server
  
paths:

  /room/create:
    post:
      summary: Creates a new room
      description:
        Creates a new room with the given options.
      tags:
        - roomHandling
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoomCreationRequest"
            example:
              name: "PCSoc Annual General Meeting"
      responses:
        "200":
          description:
            The room was created successfully and was
            registered with the server.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomCreationResponse"
              example:
                name: "PCSoc Annual General Meeting"
                code: "123456"
                token: "CDE33D83-EC29-4907-8EC0-C6FD9EB6CEFC"
        "500":
          description: 
            The room could not be created as a valid code
            could not be generated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BasicError"
              example:
                reason: "An available room code could not be generated."
  
  /room/info/{code}:
    get:
      summary: Get information about a room
      description:
        Provides information about a room,
        like whether the room code corresponds
        to a valid room
      tags:
        - roomHandling
      parameters:
        - in: path
          name: code
          required: true
          schema:
            type: string
          description:
            The room to get information on.
      responses:
        "200":
          description:
            The room exists and was found.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomInformation"
        "404":
          description:
            The room does not exist.
  
  /room/join/{code}:
    post:
      summary: Join a room
      description:
        This route only asks the room owner whether to allow you to join
        the room, it doesn't actually open a connection to the room. 
        To do that, use the `/room/connect/{code}` route.
      tags:
        - roomHandling
      parameters:
        - in: path
          name: code
          required: true
          schema:
            type: string
      responses:
        "200":
          description:
            The room does exist, and the client is permitted to enter.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomJoinInfo"
              example:
                participantToken: "CDE33D83-EC29-4907-8EC0-C6FD9EB6CEFC"
        "404":
          description:
            The room does not exist.
        "403":
          description:
            The room does exist, but the client has been rejected.

components:
  schemas:
    RoomCreationRequest:
      required:
        - name
      properties:
        name:
          type: string
          description: 
            The name of the room to create
        fields:
          type: array
          description:
            An optional list of questions to ask
            each participant
          items:
            type: string
    RoomCreationResponse:
      required:
        - name
        - code
        - adminToken
      properties:
        name:
          type: string
        fields:
          type: array
          items:
            type: string
        code:
          type: string
        adminToken:
          type: string
    RoomInformation:
      required:
        - name
        - code
      properties:
        name:
          type: string
        code:
          type: string
    RoomConnectionRequest:
      required:
        - code
      properties:
        code:
          type: string
    RoomJoinInfo:
      required:
        - participantToken
      properties:
        participantToken:
          type: string

    # MARK: - Errors
    BasicError:
      required:
        - reason
      properties:
        reason:
          type: string

tags:
  - name: roomHandling
    description:
      Routes related to room handing.
